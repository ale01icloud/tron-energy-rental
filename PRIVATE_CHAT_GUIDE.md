# 私聊功能使用指南

## 🔔 功能概述

机器人现在支持私聊功能，创建者（OWNER）可以查看所有用户的私聊消息并进行回复。

---

## 👥 用户视角

### 如何私聊机器人

1. **打开Telegram**
2. **搜索机器人**（使用机器人用户名）
3. **点击"开始"或直接发送消息**
4. **发送任意文字消息**

### 用户体验

- 发送消息后会收到确认：
  ```
  ✅ 您的消息已发送给客服
  ⏳ 请耐心等待回复
  ```

- 当客服回复时会收到：
  ```
  💬 客服回复：

  [客服的回复内容]
  ```

---

## 🎯 OWNER（创建者）视角

### 前提条件

需要在环境变量中设置 `OWNER_ID`（您的Telegram用户ID）。

**如何获取您的Telegram ID：**
1. 与 [@userinfobot](https://t.me/userinfobot) 对话
2. 它会告诉您的ID（纯数字）
3. 在Render或Replit环境变量中设置：
   ```
   OWNER_ID=123456789
   ```

### 接收私聊消息

当有用户私聊机器人时，您会收到转发消息：

```
📨 收到私聊消息
👤 张三 (@zhangsan)
🆔 User ID: 123456789
━━━━━━━━━━━━━━━━━━━━
用户发送的消息内容
━━━━━━━━━━━━━━━━━━━━
💡 回复此消息可直接回复用户
```

### 回复用户消息

**方法：回复转发的消息**

1. **找到转发的用户消息**
2. **点击"回复"（Reply）**
3. **输入您的回复内容**
4. **发送**

您会收到确认：
```
✅ 回复已发送
```

用户会收到：
```
💬 客服回复：

[您的回复内容]
```

### OWNER私聊机器人

如果您（OWNER）直接私聊机器人发送非回复消息，会收到提示：

```
💡 使用提示：
• 回复转发的消息可以回复用户
• 在群组中使用记账功能
```

---

## 📝 消息日志

### 日志存储位置

所有私聊消息都会被记录在：
```
data/logs/private_chats/user_{用户ID}.log
```

### 日志格式

```
[14:30:25] 张三 (@zhangsan): 你好，我想咨询一下
[14:31:02] OWNER回复: 您好，请问有什么可以帮助您的？
[14:31:45] 张三 (@zhangsan): 我想了解入金流程
[14:32:10] OWNER回复: 入金流程很简单...
```

### 查看日志

在Replit或服务器上：
```bash
# 查看某个用户的聊天记录
cat data/logs/private_chats/user_123456789.log

# 查看所有私聊用户
ls data/logs/private_chats/
```

---

## 🔒 隐私和安全

1. **消息转发**：所有私聊消息都会转发给OWNER
2. **日志记录**：所有对话都会被记录在服务器上
3. **访问权限**：只有OWNER可以查看和回复私聊消息
4. **建议**：不要在私聊中分享敏感信息（如密码、私钥等）

---

## 💡 使用技巧

### 管理多个用户咨询

1. **查看User ID**：每条转发消息都包含用户ID
2. **搜索历史**：在与机器人的私聊中搜索关键词找到特定用户
3. **标记重要消息**：使用Telegram的书签功能标记重要咨询

### 批量回复

如果有多个用户咨询：
1. 从上到下逐个回复转发的消息
2. 每次回复都会自动发送给对应用户
3. 系统会自动匹配消息ID和用户ID

---

## 🐛 常见问题

### Q: 用户发送的消息没有转发给我？
**A:** 检查以下几点：
- 确认已设置 `OWNER_ID` 环境变量
- 确认 `OWNER_ID` 是纯数字（您的Telegram ID）
- 重启机器人服务

### Q: 我回复了但用户没收到？
**A:** 确保：
- 您是在"回复"转发消息，而不是直接发送新消息
- 检查机器人日志是否有错误信息

### Q: 如何关闭私聊功能？
**A:** 私聊功能无法关闭，但如果没有设置 `OWNER_ID`，消息不会被转发，用户会正常收到机器人的自动回复。

### Q: 可以有多个客服吗？
**A:** 目前只支持一个OWNER接收消息。如需多人客服，建议：
- 使用一个共享的Telegram账号作为OWNER
- 或在代码中扩展为支持多个OWNER_ID

---

## 📊 功能流程图

```
用户私聊机器人
    ↓
消息记录到日志
    ↓
转发给OWNER（包含用户信息）
    ↓
用户收到确认消息
    ↓
OWNER查看并回复转发的消息
    ↓
机器人发送回复给用户
    ↓
双方消息记录到日志
```

---

## 🎯 最佳实践

1. **及时回复**：尽快回复用户咨询，提升用户体验
2. **专业用语**：保持专业、友好的沟通方式
3. **定期检查**：定期查看私聊日志，了解用户需求
4. **备份日志**：定期备份 `data/logs/private_chats/` 目录
5. **隐私保护**：告知用户消息会被记录，保护双方权益

---

## 🔄 与群组功能的关系

- **私聊**：用于客服咨询、问题反馈
- **群组**：用于财务记账、团队协作
- **两者独立**：私聊不影响群组记账功能

**建议工作流程：**
1. 用户在私聊中咨询问题
2. OWNER解答并邀请用户加入工作群组
3. 在群组中使用记账功能进行业务操作

---

## 📞 技术支持

如有问题或需要定制功能，请联系开发者。
